function u(e){return/^[a-zA-Z0-9_]{3,16}$/.test(e)}function p(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function v(e){return e.length>=8&&/\d/.test(e)&&/[a-zA-Z]/.test(e)}function f(e){return e.replace(/[<>'"/]/g,"")}function w(e){return e.replace(/[&<>"'`=/]/g,n=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;","=":"&#61;","/":"&#47;"})[n]||"")}const i={email:p,escapeHTML:w,password:v,username:u,sanitizeInput:f};function L(){document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("signup-form"),n=document.getElementById("login-form");e&&e.addEventListener("submit",o=>h(o,e)),n&&n.addEventListener("submit",o=>E(o,n))})}function h(e,n){const o=i.sanitizeInput(n.querySelector("#signup-email").value),t=i.sanitizeInput(n.querySelector("#signup-password").value),s=i.sanitizeInput(n.querySelector("#signup-username").value);if(!i.username(s)){alert("Invalid username: Must be 3-16 characters long (letters, numbers, underscore).");return}if(!i.email(o)){alert("Invalid email format.");return}if(!i.password(t)){alert("Password must be at least 8 characters long, with letters and numbers.");return}console.log("Form is valid. Sending sanitized data:",{username:s,email:o,password:t}),fetch("/api/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:s,email:o,password:t})}).then(r=>r.json()).then(r=>console.log("Server response:",r)).catch(r=>console.error("Error:",r))}function E(e,n){e.preventDefault();const o=i.sanitizeInput(n.querySelector("#login-email").value),t=i.sanitizeInput(n.querySelector("#login-password").value);if(!i.email(o)){alert("Invalid email format.");return}if(!i.password(t)){alert("Password must be at least 8 characters long, with letters and numbers.");return}console.log("âœ… Login form valid. Sending sanitized data:",{email:o,password:t}),fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o,password:t})}).then(s=>s.json()).then(s=>console.log("Server response:",s)).catch(s=>console.error("Error:",s))}async function y(){try{let e=function(a){a.addEventListener("click",m=>{console.log("Clicked on:",m.target),console.log("Modal itself is:",a),m.target===a?(console.log("Closing modal (outside click)..."),a.classList.remove("show")):console.log("Click detected inside modal content.")})};const n=document.getElementById("login-modal"),o=document.getElementById("signup-modal"),t=document.getElementById("forgot-password-modal"),s=document.getElementById("open-login-modal"),r=document.getElementById("open-signup-modal"),l=document.getElementById("open-forgot-password-modal"),c=document.getElementById("close-login-modal"),d=document.getElementById("close-signup-modal"),g=document.getElementById("close-forgot-password-modal");if(!n||!o||!t||!s||!r||!l||!c||!d||!g){console.error("One or more modal elements not found!");return}s.addEventListener("click",()=>{console.log("Opening login modal..."),n.classList.add("show")}),r.addEventListener("click",()=>{console.log("Opening signup modal..."),o.classList.add("show")}),l.addEventListener("click",()=>{n.classList.remove("show"),t.classList.add("show")}),c.addEventListener("click",()=>{console.log("Closing login modal..."),n.classList.remove("show")}),d.addEventListener("click",()=>{console.log("Closing signup modal..."),o.classList.remove("show")}),g.addEventListener("click",()=>{t.classList.remove("show")}),e(n),e(o),e(t),document.addEventListener("keydown",a=>{a.key==="Escape"&&(n.classList.contains("show")&&(console.log("Closing login modal (Escape key)..."),n.classList.remove("show")),o.classList.contains("show")&&(console.log("Closing signup modal (Escape key)..."),o.classList.remove("show")),t.classList.contains("show")&&(console.log("Closing forgot password modal (Escape key)..."),t.classList.remove("show")))})}catch(e){console.error("Error adding modal event listeners:",e)}}async function I(){try{document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("no-js-warning"),n=document.getElementById("dismiss-js-warning");e&&n&&(localStorage.getItem("js-warning-dismissed")?e.remove():n.addEventListener("click",()=>{e.remove(),localStorage.setItem("js-warning-dismissed","true")}))})}catch(e){console.error("Error adding no-script event listeners:",e)}}async function B(){try{L(),await y(),await I()}catch(e){console.error("Error registering event listeners:",e)}}export{B as registerListeners};
