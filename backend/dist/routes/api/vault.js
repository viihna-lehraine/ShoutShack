// File: backend/src/api/vault.ts
import axios from 'axios';
import fs from 'fs';
const VAULT_ADDR = process.env.VAULT_ADDR || 'https://shoutshack-vault:8200';
const VAULT_TOKEN = process.env.VAULT_TOKEN || 'shoutshack-root'; // TODO: Replace with dynamic authentication
const httpsAgent = new (require('https').Agent)({
    rejectUnauthorized: true,
    ca: fs.readFileSync('/app/tls/ca.crt').toString(),
    cert: fs.readFileSync('/app/tls/backend.crt').toString(),
    key: fs.readFileSync('/app/tls/backend.key').toString()
});
const vaultClient = axios.create({
    baseURL: `${VAULT_ADDR}/v1`,
    headers: { 'X-Vault-Token': VAULT_TOKEN },
    httpsAgent
});
export async function getSecret(secretPath) {
    try {
        const response = await vaultClient.get(`/secret/data/${secretPath}`);
        return response.data?.data?.data;
    }
    catch (err) {
        console.error('Failed to fetch secret from Vault', err);
        throw err;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmF1bHQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcm91dGVzL2FwaS92YXVsdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxpQ0FBaUM7QUFFakMsT0FBTyxLQUFLLE1BQU0sT0FBTyxDQUFDO0FBQzFCLE9BQU8sRUFBRSxNQUFNLElBQUksQ0FBQztBQUVwQixNQUFNLFVBQVUsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsSUFBSSwrQkFBK0IsQ0FBQztBQUM3RSxNQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsSUFBSSxpQkFBaUIsQ0FBQyxDQUFDLDRDQUE0QztBQUU5RyxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQy9DLGtCQUFrQixFQUFFLElBQUk7SUFDeEIsRUFBRSxFQUFFLEVBQUUsQ0FBQyxZQUFZLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxRQUFRLEVBQUU7SUFDakQsSUFBSSxFQUFFLEVBQUUsQ0FBQyxZQUFZLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxRQUFRLEVBQUU7SUFDeEQsR0FBRyxFQUFFLEVBQUUsQ0FBQyxZQUFZLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxRQUFRLEVBQUU7Q0FDdkQsQ0FBQyxDQUFDO0FBRUgsTUFBTSxXQUFXLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQztJQUNoQyxPQUFPLEVBQUUsR0FBRyxVQUFVLEtBQUs7SUFDM0IsT0FBTyxFQUFFLEVBQUUsZUFBZSxFQUFFLFdBQVcsRUFBRTtJQUN6QyxVQUFVO0NBQ1YsQ0FBQyxDQUFDO0FBRUgsTUFBTSxDQUFDLEtBQUssVUFBVSxTQUFTLENBQUMsVUFBa0I7SUFDakQsSUFBSSxDQUFDO1FBQ0osTUFBTSxRQUFRLEdBQUcsTUFBTSxXQUFXLENBQUMsR0FBRyxDQUFDLGdCQUFnQixVQUFVLEVBQUUsQ0FBQyxDQUFDO1FBQ3JFLE9BQU8sUUFBUSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDO0lBQ2xDLENBQUM7SUFBQyxPQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2QsT0FBTyxDQUFDLEtBQUssQ0FBQyxtQ0FBbUMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUN4RCxNQUFNLEdBQUcsQ0FBQztJQUNYLENBQUM7QUFDRixDQUFDIn0=