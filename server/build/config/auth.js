// File: server/config/auth.ts
import argon2 from 'argon2';
import { env } from './env.js';
export const registerAuth = (app) => {
    app.register(import('@fastify/jwt'), {
        secret: process.env.JWT_SECRET
    });
    app.decorate('hashPassword', async (password) => {
        return await argon2.hash(password + env.PEPPER, {
            type: argon2.argon2id,
            memoryCost: env.A2_MEMCOST,
            timeCost: env.A2_TIMECOST,
            parallelism: env.A2_PARALLELISM
        });
    });
    app.decorate('authenticate', async (request, reply) => {
        try {
            await request.jwtVerify();
        }
        catch (err) {
            reply.code(401).send({ error: 'Unauthorized' });
        }
    });
    app.decorate('authenticate', async (request, reply) => {
        try {
            await request.jwtVerify();
        }
        catch (err) {
            reply.code(401).send({ error: 'Unauthorized' });
        }
    });
    console.log('Authentication middleware registered');
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb25maWcvYXV0aC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSw4QkFBOEI7QUFFOUIsT0FBTyxNQUFNLE1BQU0sUUFBUSxDQUFDO0FBQzVCLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFHL0IsTUFBTSxDQUFDLE1BQU0sWUFBWSxHQUFHLENBQUMsR0FBb0IsRUFBRSxFQUFFO0lBQ3BELEdBQUcsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxFQUFFO1FBQ3BDLE1BQU0sRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVc7S0FDL0IsQ0FBQyxDQUFDO0lBRUgsR0FBRyxDQUFDLFFBQVEsQ0FBQyxjQUFjLEVBQUUsS0FBSyxFQUFFLFFBQWdCLEVBQUUsRUFBRTtRQUN2RCxPQUFPLE1BQU0sTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLE1BQU0sRUFBRTtZQUMvQyxJQUFJLEVBQUUsTUFBTSxDQUFDLFFBQVE7WUFDckIsVUFBVSxFQUFFLEdBQUcsQ0FBQyxVQUFVO1lBQzFCLFFBQVEsRUFBRSxHQUFHLENBQUMsV0FBVztZQUN6QixXQUFXLEVBQUUsR0FBRyxDQUFDLGNBQWM7U0FDL0IsQ0FBQyxDQUFDO0lBQ0osQ0FBQyxDQUFDLENBQUM7SUFFSCxHQUFHLENBQUMsUUFBUSxDQUFDLGNBQWMsRUFBRSxLQUFLLEVBQUUsT0FBdUIsRUFBRSxLQUFtQixFQUFFLEVBQUU7UUFDbkYsSUFBSSxDQUFDO1lBQ0osTUFBTSxPQUFPLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDM0IsQ0FBQztRQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7WUFDZCxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxjQUFjLEVBQUUsQ0FBQyxDQUFDO1FBQ2pELENBQUM7SUFDRixDQUFDLENBQUMsQ0FBQztJQUVILEdBQUcsQ0FBQyxRQUFRLENBQUMsY0FBYyxFQUFFLEtBQUssRUFBRSxPQUF1QixFQUFFLEtBQW1CLEVBQUUsRUFBRTtRQUNuRixJQUFJLENBQUM7WUFDSixNQUFNLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUMzQixDQUFDO1FBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztZQUNkLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLGNBQWMsRUFBRSxDQUFDLENBQUM7UUFDakQsQ0FBQztJQUNGLENBQUMsQ0FBQyxDQUFDO0lBRUgsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO0FBQ3JELENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEZpbGU6IHNlcnZlci9jb25maWcvYXV0aC50c1xuXG5pbXBvcnQgYXJnb24yIGZyb20gJ2FyZ29uMic7XG5pbXBvcnQgeyBlbnYgfSBmcm9tICcuL2Vudi5qcyc7XG5pbXBvcnQgeyBGYXN0aWZ5SW5zdGFuY2UsIEZhc3RpZnlSZXF1ZXN0LCBGYXN0aWZ5UmVwbHkgfSBmcm9tICdmYXN0aWZ5JztcblxuZXhwb3J0IGNvbnN0IHJlZ2lzdGVyQXV0aCA9IChhcHA6IEZhc3RpZnlJbnN0YW5jZSkgPT4ge1xuXHRhcHAucmVnaXN0ZXIoaW1wb3J0KCdAZmFzdGlmeS9qd3QnKSwge1xuXHRcdHNlY3JldDogcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCFcblx0fSk7XG5cblx0YXBwLmRlY29yYXRlKCdoYXNoUGFzc3dvcmQnLCBhc3luYyAocGFzc3dvcmQ6IHN0cmluZykgPT4ge1xuXHRcdHJldHVybiBhd2FpdCBhcmdvbjIuaGFzaChwYXNzd29yZCArIGVudi5QRVBQRVIsIHtcblx0XHRcdHR5cGU6IGFyZ29uMi5hcmdvbjJpZCxcblx0XHRcdG1lbW9yeUNvc3Q6IGVudi5BMl9NRU1DT1NULFxuXHRcdFx0dGltZUNvc3Q6IGVudi5BMl9USU1FQ09TVCxcblx0XHRcdHBhcmFsbGVsaXNtOiBlbnYuQTJfUEFSQUxMRUxJU01cblx0XHR9KTtcblx0fSk7XG5cblx0YXBwLmRlY29yYXRlKCdhdXRoZW50aWNhdGUnLCBhc3luYyAocmVxdWVzdDogRmFzdGlmeVJlcXVlc3QsIHJlcGx5OiBGYXN0aWZ5UmVwbHkpID0+IHtcblx0XHR0cnkge1xuXHRcdFx0YXdhaXQgcmVxdWVzdC5qd3RWZXJpZnkoKTtcblx0XHR9IGNhdGNoIChlcnIpIHtcblx0XHRcdHJlcGx5LmNvZGUoNDAxKS5zZW5kKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0pO1xuXHRcdH1cblx0fSk7XG5cblx0YXBwLmRlY29yYXRlKCdhdXRoZW50aWNhdGUnLCBhc3luYyAocmVxdWVzdDogRmFzdGlmeVJlcXVlc3QsIHJlcGx5OiBGYXN0aWZ5UmVwbHkpID0+IHtcblx0XHR0cnkge1xuXHRcdFx0YXdhaXQgcmVxdWVzdC5qd3RWZXJpZnkoKTtcblx0XHR9IGNhdGNoIChlcnIpIHtcblx0XHRcdHJlcGx5LmNvZGUoNDAxKS5zZW5kKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0pO1xuXHRcdH1cblx0fSk7XG5cblx0Y29uc29sZS5sb2coJ0F1dGhlbnRpY2F0aW9uIG1pZGRsZXdhcmUgcmVnaXN0ZXJlZCcpO1xufTtcbiJdfQ==