export class Mutex {
    #locked = false;
    #waiting = [];
    async lock() {
        if (this.#locked) {
            await new Promise(resolve => this.#waiting.push(resolve));
        }
        this.#locked = true;
    }
    unlock() {
        this.#locked = false;
        if (this.#waiting.length > 0) {
            const next = this.#waiting.shift();
            next && next();
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTXV0ZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tbW9uL3NlcnZpY2VzL011dGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE1BQU0sT0FBTyxLQUFLO0lBQ2pCLE9BQU8sR0FBWSxLQUFLLENBQUM7SUFDekIsUUFBUSxHQUFzQixFQUFFLENBQUM7SUFFakMsS0FBSyxDQUFDLElBQUk7UUFDVCxJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNsQixNQUFNLElBQUksT0FBTyxDQUFPLE9BQU8sQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUNqRSxDQUFDO1FBQ0QsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7SUFDckIsQ0FBQztJQUVELE1BQU07UUFDTCxJQUFJLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQztRQUNyQixJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQzlCLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDbkMsSUFBSSxJQUFJLElBQUksRUFBRSxDQUFDO1FBQ2hCLENBQUM7SUFDRixDQUFDO0NBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNdXRleENvbnRyYWN0IH0gZnJvbSAnLi4vLi4vdHlwZXMvaW5kZXguanMnO1xuXG5leHBvcnQgY2xhc3MgTXV0ZXggaW1wbGVtZW50cyBNdXRleENvbnRyYWN0IHtcblx0I2xvY2tlZDogYm9vbGVhbiA9IGZhbHNlO1xuXHQjd2FpdGluZzogQXJyYXk8KCkgPT4gdm9pZD4gPSBbXTtcblxuXHRhc3luYyBsb2NrKCkge1xuXHRcdGlmICh0aGlzLiNsb2NrZWQpIHtcblx0XHRcdGF3YWl0IG5ldyBQcm9taXNlPHZvaWQ+KHJlc29sdmUgPT4gdGhpcy4jd2FpdGluZy5wdXNoKHJlc29sdmUpKTtcblx0XHR9XG5cdFx0dGhpcy4jbG9ja2VkID0gdHJ1ZTtcblx0fVxuXG5cdHVubG9jaygpIHtcblx0XHR0aGlzLiNsb2NrZWQgPSBmYWxzZTtcblx0XHRpZiAodGhpcy4jd2FpdGluZy5sZW5ndGggPiAwKSB7XG5cdFx0XHRjb25zdCBuZXh0ID0gdGhpcy4jd2FpdGluZy5zaGlmdCgpO1xuXHRcdFx0bmV4dCAmJiBuZXh0KCk7XG5cdFx0fVxuXHR9XG59XG4iXX0=