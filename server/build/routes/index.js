// File: server/src/routes/index.ts
import fs from 'fs/promises';
import path from 'path';
import { registerApiRoutes } from './api/main.js';
import { registerStaticRoutes } from './static/main.js';
export const registerRoutes = (fastify) => {
    registerApiRoutes(fastify);
    registerStaticRoutes(fastify);
    fastify.setNotFoundHandler(async (_request, reply) => {
        try {
            const filePath = path.join('/usr/share/nginx/html', '404.html');
            const content = await fs.readFile(filePath, 'utf-8');
            reply.code(404).type('text/html').send(content);
        }
        catch (err) {
            reply.code(404).send('404 Not Found');
        }
    });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvcm91dGVzL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLG1DQUFtQztBQUduQyxPQUFPLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDN0IsT0FBTyxJQUFJLE1BQU0sTUFBTSxDQUFDO0FBQ3hCLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNsRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUV4RCxNQUFNLENBQUMsTUFBTSxjQUFjLEdBQUcsQ0FBQyxPQUF3QixFQUFFLEVBQUU7SUFDMUQsaUJBQWlCLENBQUMsT0FBTyxDQUFDLENBQUM7SUFFM0Isb0JBQW9CLENBQUMsT0FBTyxDQUFDLENBQUM7SUFFOUIsT0FBTyxDQUFDLGtCQUFrQixDQUFDLEtBQUssRUFBRSxRQUF3QixFQUFFLEtBQW1CLEVBQUUsRUFBRTtRQUNsRixJQUFJLENBQUM7WUFDSixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLHVCQUF1QixFQUFFLFVBQVUsQ0FBQyxDQUFDO1lBQ2hFLE1BQU0sT0FBTyxHQUFHLE1BQU0sRUFBRSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFFckQsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2pELENBQUM7UUFBQyxPQUFPLEdBQUcsRUFBRSxDQUFDO1lBQ2QsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDdkMsQ0FBQztJQUNGLENBQUMsQ0FBQyxDQUFDO0FBQ0osQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gRmlsZTogc2VydmVyL3NyYy9yb3V0ZXMvaW5kZXgudHNcblxuaW1wb3J0IHsgRmFzdGlmeUluc3RhbmNlLCBGYXN0aWZ5UmVxdWVzdCwgRmFzdGlmeVJlcGx5IH0gZnJvbSAnZmFzdGlmeSc7XG5pbXBvcnQgZnMgZnJvbSAnZnMvcHJvbWlzZXMnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyByZWdpc3RlckFwaVJvdXRlcyB9IGZyb20gJy4vYXBpL21haW4uanMnO1xuaW1wb3J0IHsgcmVnaXN0ZXJTdGF0aWNSb3V0ZXMgfSBmcm9tICcuL3N0YXRpYy9tYWluLmpzJztcblxuZXhwb3J0IGNvbnN0IHJlZ2lzdGVyUm91dGVzID0gKGZhc3RpZnk6IEZhc3RpZnlJbnN0YW5jZSkgPT4ge1xuXHRyZWdpc3RlckFwaVJvdXRlcyhmYXN0aWZ5KTtcblxuXHRyZWdpc3RlclN0YXRpY1JvdXRlcyhmYXN0aWZ5KTtcblxuXHRmYXN0aWZ5LnNldE5vdEZvdW5kSGFuZGxlcihhc3luYyAoX3JlcXVlc3Q6IEZhc3RpZnlSZXF1ZXN0LCByZXBseTogRmFzdGlmeVJlcGx5KSA9PiB7XG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IGZpbGVQYXRoID0gcGF0aC5qb2luKCcvdXNyL3NoYXJlL25naW54L2h0bWwnLCAnNDA0Lmh0bWwnKTtcblx0XHRcdGNvbnN0IGNvbnRlbnQgPSBhd2FpdCBmcy5yZWFkRmlsZShmaWxlUGF0aCwgJ3V0Zi04Jyk7XG5cblx0XHRcdHJlcGx5LmNvZGUoNDA0KS50eXBlKCd0ZXh0L2h0bWwnKS5zZW5kKGNvbnRlbnQpO1xuXHRcdH0gY2F0Y2ggKGVycikge1xuXHRcdFx0cmVwbHkuY29kZSg0MDQpLnNlbmQoJzQwNCBOb3QgRm91bmQnKTtcblx0XHR9XG5cdH0pO1xufTtcbiJdfQ==